<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARTGOD Experience</title>
    <style>
        body {
            background-color: #000;
            color: #f0f0f0;
            /* ✅ FIX: Proper cross-platform font stack for San Francisco */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        #scroll-section {
            position: relative;
            height: 500vh; 
        }

        .sticky-container {
            height: 100vh;
            width: 100%;
            position: sticky;
            top: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #image-sequence-canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: block; 
        }
        
        .portal-spacer {
            height: 100vh;
            width: 100%;
        }
        
        .intro-text-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            z-index: 10;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        .intro-text-wrapper.fade-out {
            opacity: 0;
        }
        .intro-text-content {
            padding-left: 5vw;
            max-width: 500px;
        }
        .intro-text-content p {
             font-size: 1.1rem;
             line-height: 1.6;
             font-weight: 400;
             margin: 1.5rem 0;
             text-align: left;
        }

        #subtitle-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 33vh;
            z-index: 20;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            text-align: center;
        }

        .subtitle-sentence {
            font-size: 1.6rem;
            line-height: 1.4;
            font-weight: 500;
            text-shadow: 0px 2px 15px rgba(0,0,0,0.8);
            position: absolute;
            width: 100%;
            max-width: 800px;
            padding: 0 2rem;
            box-sizing: border-box;
            margin: 0;
            opacity: 0;
            transform: translateY(0) scale(1); 
        }
    </style>
</head>
<body>

    <div id="scroll-section">
        <div class="sticky-container">
            <canvas id="image-sequence-canvas"></canvas>
        </div>
        <div class="portal-spacer"></div>
        <div class="portal-spacer"></div>
        <div class="portal-spacer"></div>
        <div class="portal-spacer"></div>
        <div class="portal-spacer"></div>
    </div>

    <div class="intro-text-wrapper">
        <div class="intro-text-content">
            <p>It's 1994 . . . There’s a pay phone on the corner<br>of Exposition & Vermont in downtown Los Angeles.</p>
            <p>The phone begins to ring and ring and ring.<br>There's no one around.<br>Do you pick up?</p>
            <p>You can’t resist. You answer.<br>ARTgod is born.</p>
            <p>You’ve never forgotten the connection -<br>the exchange, the questions, your answers . . .</p>
            <p>It's 2024 . . . There’s a pay phone in the lobby of the<br>Lucas Museum of Narrative Art.</p>
            <p>The phone begins to ring and this time you don’t hesitate.<br>The connection is restored.<br>The frequency is open . . .<br>ARTgod is here.</p>
        </div>
    </div>

    <div id="subtitle-container">
        <p class="subtitle-sentence">(Audible note: phone is ringing in the background)</p>
        <p class="subtitle-sentence">Welcome to ARTgod, a portal into another dimension where your voice creates art.</p>
        <p class="subtitle-sentence">As you enter the booth, the 1990’s battered, graffiti covered exterior opens into a fantastical high-tech pod lined with LED screens.</p>
        <p class="subtitle-sentence">The script has been flipped!</p>
        <p class="subtitle-sentence">You now realize that YOU are the ARTgod.</p>
        <p class="subtitle-sentence">Each question posed encourages creative answers about your opinions about art and the art world, serving as a recording of history.</p>
        <p class="subtitle-sentence">As the conversation takes shape, so do the images on the LED screens.</p>
        <p class="subtitle-sentence">Morphing images reflect your specific answers and we flip the script again - the ARTgod becomes the Artist.</p>
        <p class="subtitle-sentence">As the conversation winds down, you are offered a gift.</p>
        <p class="subtitle-sentence">A small touchscreen near the phone lights up and invites you to receive a printed postcard with your new original artwork.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('image-sequence-canvas');
            if (!canvas) { return; }
            const context = canvas.getContext('2d');

            const subtitleSentences = document.querySelectorAll('#subtitle-container .subtitle-sentence');
            const totalSentences = subtitleSentences.length;
            const introWrapper = document.querySelector('.intro-text-wrapper');

            const loopFrameCount = 73; 
            const scrollFrameCount = 313;
            const animationSpeed = 30; 

            const getLoopImagePath = i => `img/VIDEO/OPENING STILLS${i.toString().padStart(4, '0')}.jpg`;
            const getScrollImagePath = i => `img/SCROLLING/SCROLLING${i.toString().padStart(4, '0')}.jpg`;

            const loopImages = [];
            const scrollImages = [];
            
            let loopFrameIndex = 0;
            let lastTime = 0;

            const preloadImages = () => {
                const promises = [];
                for (let i = 0; i < loopFrameCount; i++) {
                    promises.push(new Promise(resolve => {
                        const img = new Image(); img.src = getLoopImagePath(i); img.onload = resolve; img.onerror = resolve; loopImages[i] = img;
                    }));
                }
                for (let i = 0; i < scrollFrameCount; i++) {
                    promises.push(new Promise(resolve => {
                        const img = new Image(); img.src = getScrollImagePath(i); img.onload = resolve; img.onerror = resolve; scrollImages[i] = img;
                    }));
                }
                return Promise.all(promises);
            };
            
            const setCanvasSize = () => {
                const firstImage = loopImages[0] || scrollImages[0];
                if (!firstImage || !firstImage.complete || firstImage.naturalWidth === 0) return;
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const imageAspectRatio = firstImage.naturalWidth / firstImage.naturalHeight;
                let newCanvasWidth, newCanvasHeight;
                if (viewportWidth / viewportHeight > imageAspectRatio) {
                    newCanvasWidth = viewportWidth; newCanvasHeight = viewportWidth / imageAspectRatio;
                } else {
                    newCanvasHeight = viewportHeight; newCanvasWidth = viewportHeight * imageAspectRatio;
                }
                canvas.style.width = `${newCanvasWidth}px`; canvas.style.height = `${newCanvasHeight}px`;
                canvas.width = firstImage.naturalWidth; canvas.height = firstImage.naturalHeight;
            };

            const drawImage = (img) => {
                if (img && img.complete && img.naturalWidth > 0) {
                    context.clearRect(0, 0, canvas.width, canvas.height);
                    context.drawImage(img, 0, 0, canvas.width, canvas.height);
                }
            };
            
            // ✅ FIX: The render loop is now the single source of truth, no more 'hasScrolled' flag
            const render = (currentTime) => {
                const scrollTop = window.scrollY;

                if (scrollTop < 10) { // We are at the top, play the hero loop
                    introWrapper.classList.remove('fade-out');

                    if (currentTime - lastTime > 1000 / animationSpeed) {
                        drawImage(loopImages[loopFrameIndex]);
                        loopFrameIndex = (loopFrameIndex + 1) % loopFrameCount;
                        lastTime = currentTime;
                    }
                    // Hide subtitles when at the top
                    subtitleSentences.forEach(sentence => sentence.style.opacity = 0);

                } else { // We have scrolled down, play the scroll animations
                    introWrapper.classList.add('fade-out');

                    // Canvas image sequence logic
                    const imageAnimationScrollHeight = window.innerHeight * 3;
                    const imageScrollFraction = Math.min(1, Math.max(0, scrollTop / imageAnimationScrollHeight));
                    const frameIndex = Math.min(scrollFrameCount - 1, Math.floor(imageScrollFraction * scrollFrameCount));
                    drawImage(scrollImages[frameIndex]);

                    // Subtitle sentence logic
                    const sentenceAnimationStart = window.innerHeight * 0.5;
                    const sentenceAnimationHeight = window.innerHeight * 4;
                    const sentenceScrollProgress = Math.min(1, Math.max(0, (scrollTop - sentenceAnimationStart) / sentenceAnimationHeight));
                    
                    const sentenceDuration = 1 / totalSentences;
                    const activeSentenceIndex = Math.floor(sentenceScrollProgress / sentenceDuration);

                    subtitleSentences.forEach((sentence, index) => {
                        if (index === activeSentenceIndex) {
                            const progressWithinSentence = (sentenceScrollProgress - (index * sentenceDuration)) / sentenceDuration;
                            
                            const halfPoint = 0.5;
                            let opacity = 0;
                            if (progressWithinSentence < halfPoint) {
                                opacity = progressWithinSentence / halfPoint;
                            } else {
                                opacity = 1 - ((progressWithinSentence - halfPoint) / halfPoint);
                            }
                            
                            const startY = -20;
                            const endY = 40;
                            const translateY = startY + (progressWithinSentence * (endY - startY));
                            const scale = 1 + (progressWithinSentence * 0.05);

                            sentence.style.opacity = Math.pow(opacity, 2);
                            sentence.style.transform = `translateY(${translateY}px) scale(${scale})`;

                        } else {
                            sentence.style.opacity = 0;
                        }
                    });
                }
                requestAnimationFrame(render);
            };
            
            preloadImages().then(() => {
                setCanvasSize();
                window.addEventListener('resize', setCanvasSize);
                requestAnimationFrame(render);
            });
        });
    </script>
</body>
</html>